---
import { type CollectionEntry, getCollection, render } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import FormattedDate from '../../components/FormattedDate.astro';

export async function getStaticPaths() {
  	const posts = await getCollection('blog');

  	const sorted = posts.sort(
    	(a, b) => new Date(b.data.pubDate).valueOf() - new Date(a.data.pubDate).valueOf()
  	);

  	return sorted.map((post, index) => ({
    	params: { slug: post.id },
    	props: {
      		post,
      		prev: sorted[index + 1] ?? null,
      		next: sorted[index - 1] ?? null,
    	},
  	}));
}

const { post, prev, next } = Astro.props;
const { Content } = await render(post);
---

<Layout title={post.data.title}>
  	<article class="post-window">
    	<div class="post-header">
      		<FormattedDate date={post.data.pubDate} />
    	</div>

    	<div class="post-body">
      	<h1>{post.data.title}</h1>

      		{post.data.heroImage && (
        		<img src={post.data.heroImage} alt={post.data.title} />
      		)}
      	<Content />
    	</div>

    	<nav class="post-nav">
      		<a href="/blog" class="back-link">← Back to blog</a>

      		<div class="prev-next">
        		{prev && (
          			<a href={`/blog/${prev.id}`} class="prev">
            			← {prev.data.title}
          			</a>
        		)}

        		{next && (
          			<a href={`/blog/${next.id}`} class="next">
            			{next.data.title} →
          			</a>
        		)}
      		</div>
    	</nav>
  	</article>
</Layout>


<style>
.post-window {
  	color: white;
}

.post-body {
  	padding: 1.25rem;
}

.post-nav {
  	padding: 1.25rem;
  	display: flex;
  	flex-direction: column;
  	gap: 1rem;
}

.back-link {
  	opacity: 0.8;
}

.prev-next {
  	display: flex;
  	justify-content: space-between;
  	gap: 1rem;
}

.prev,
.next {
  	max-width: 48%;
}


.post-body img {
  	width: 100%;
  	max-height: 320px;
  	object-fit: cover;
  	margin: 1rem 0;
}

h1 {
  	margin-top: 0;
}
</style>
